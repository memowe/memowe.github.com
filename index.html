<!doctype html>
<html lang="de">
<head>
    <meta charset="utf-8">
    <title>Mirko Westermeier</title>
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/showdown"></script>
</head>
<body>

    <div id="noscript">
        <h1>Mirko Westermeier</h1>
        <p>Überwasserstraße 31-33<br>48143 Münster</p>
        <p>E-Mail: <a href="mailto:mirko@westermeier.de">mirko@westermeier.de</a></p>
    </div>

    <main>
        <div id="mirko"></div>
        <div id="sections"></div>
    </main>

    <footer></footer>

    <script defer>

        // Prepare markdown translator
        const sd = new showdown.Converter({metadata: true})

        // Prepare markdown data loader
        const loadMarkdown = section => fetch(`content/${section}.md`)
            .then(res => res.text())
            .then(markdown => ({
                section:    section,
                html:       sd.makeHtml(markdown),
                meta:       sd.getMetadata(),
            }))

        // Load content
        const sections      = ['dh', 'dance', 'software']
        const loadMirko     = loadMarkdown('mirko')
        const loadSections  = Promise.all(sections.map(loadMarkdown))
        const loadFooter    = loadMarkdown('footer')

        const mount = (selector, html) =>
            document.querySelector(selector).innerHTML = html

        // Mount content
        Promise.all([loadMirko, loadSections, loadFooter]).then(results => {
            const [mirko, sections, footer] = results

            document.querySelector('#noscript').remove()
            mount('#mirko', mirko.html)
            mount('#sections', sections.map(s => `<section id="${s.section}">${s.html}</section>`).join(''))
            mount('footer', footer.html)
        })

    </script>
</body>
</html>
