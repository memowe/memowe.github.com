<!doctype html>
<html lang="de">
<head>
    <meta charset="utf-8">
    <title>Mirko Westermeier</title>
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <meta name="theme-color" content="#ffeaba">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sanitize.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Fira+Sans:wght@300;400;700&display=swap">
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/showdown"></script>
    <script src="https://cdn.jsdelivr.net/npm/showdown-icon"></script>
    <script src="https://kit.fontawesome.com/19d5a9ee53.js"></script>
</head>
<body>

    <div id="noscript">
        <h1>Mirko Westermeier</h1>
        <p>Überwasserstraße 31-33<br>48143 Münster</p>
        <p>E-Mail: <a href="mailto:mirko@westermeier.de">mirko@westermeier.de</a></p>
    </div>

    <header>
        <div id="mirko"></div>
    </header>

    <main>
        <div id="sections"></div>
    </main>

    <footer>
        <div id="footer">
            <div id="footer-copyright"></div>
            <div id="footer-icons"></div>
        </div>
    </footer>

    <script defer>

        // Prepare markdown translator
        const sd = new showdown.Converter({
            metadata:   true,
            extensions: ['icon'],
        })

        // Prepare markdown data loader
        const loadMarkdown = section => fetch(`content/${section}.md`)
            .then(res => res.text())
            .then(markdown => ({
                section:    section,
                html:       sd.makeHtml(markdown),
                meta:       sd.getMetadata(),
            }))

        // Load content
        const sections              = ['dh', 'dance', 'software']
        const loadMirko             = loadMarkdown('mirko')
        const loadSections          = Promise.all(sections.map(loadMarkdown))
        const loadFooterCopyright   = loadMarkdown('footer-copyright')
        const loadFooterIcons       = loadMarkdown('footer-icons')

        const mount = (selector, html) =>
            document.querySelector(selector).innerHTML = html
        const wrap = (section, html) => `
            <section id="${section}">
                <div class="section-head">
                    <img src="images/sections/${section}.png" alt="">
                </div>
                <div class="section-content">${html}</div>
            </section>
        `

        // Mount content
        const promises = [loadMirko, loadSections, loadFooterCopyright, loadFooterIcons]
        Promise.all(promises).then(results => {
            const [mirko, sections, footerC, footerI] = results

            document.querySelector('#noscript').remove()
            mount('#mirko', mirko.html)
            mount('#sections', sections.map(s => wrap(s.section, s.html)).join(''))
            mount('#footer-copyright', footerC.html)
            mount('#footer-icons', footerI.html)
        })

    </script>
</body>
</html>
